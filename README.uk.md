# AI Крипто Ф'ючерсний Інтрадей Сканер

AI-сканер для інтрадей-трейдингу криптовалютних ф'ючерсів на Binance. Поєднує навчену **ML-модель XGBoost** з **аналізом OpenAI LLM** (гібридний підхід) для генерації торгових сигналів із точками входу, стоп-лосом та тейк-профітом.

## Як це працює

```
Binance Futures API          CoinGecko API
     │                            │
     ▼                            ▼
┌─────────────┐          ┌───────────────┐
│ OHLCV дані  │          │ USDT/USDC Dom │
│ OI, L/S     │          │ Total MCap    │
│ Funding Rate│          │ Stablecoin %  │
└──────┬──────┘          └───────┬───────┘
       │                         │
       ▼                         ▼
┌──────────────────────────────────────┐
│       Технічні індикатори             │
│  RSI, MACD, Bollinger, EMA, ATR,     │
│  ADX, StochRSI, OBV, Volume Ratio    │
└──────────────────┬───────────────────┘
                   │
       ┌───────────┴───────────┐
       ▼                       ▼
┌─────────────┐        ┌─────────────┐
│  ML движок  │        │  LLM движок │
│  (XGBoost)  │        │  (GPT-4o)   │
│             │        │             │
│ 36 фічей    │        │ Повний      │
│ 3 класи     │        │ ринковий    │
│ BUY/SELL/   │        │ контекст    │
│ HOLD        │        │             │
│ Вага: 60%   │        │ Вага: 40%   │
└──────┬──────┘        └──────┬──────┘
       │                      │
       └──────────┬───────────┘
                  ▼
       ┌───────────────────┐
       │ Генератор сигналів│
       │ Зважене голосуван.│
       │ + бонус згоди     │
       │ + SL/TP через ATR │
       └───────────────────┘
```

## Можливості

### Мультипарний сканер
- Сканує **10 топових ф'ючерсних пар** одночасно (BTC, ETH, BNB, SOL, XRP, DOGE, ADA, AVAX, LINK, DOT)
- Список пар налаштовується в `src/config.py`

### Мультитаймфреймовий аналіз
- **Основний (5m)** — головна генерація сигналів, 21 базова технічна фіча
- **Підтверджуючий (15m)** — підтвердження, 6 фічей вищого ТФ
- **Трендовий (1h)** — макро-фільтр тренду, 6 фічей вищого ТФ

### Технічні індикатори (21+)
RSI, MACD (лінія + гістограма), Bollinger Bands (%B), EMA (9/21/50), ATR, ADX (з DMP/DMN), Stochastic RSI, OBV, Volume Ratio, перетини EMA, зміни ціни (1/5/15 барів), анатомія свічки (тіло, тіні), дивергенція RSI

### Ринковий контекст
| Дані | Джерело | Призначення |
|------|---------|-------------|
| Open Interest + історія | Binance `/futures/data/` | Переконаність ринку, тренд OI |
| Long/Short Ratio | Binance `/futures/data/` | Позиціонування натовпу (контраріан) |
| Funding Rate | Binance Futures API | Вартість утримання, сентимент |
| USDT Домінація | CoinGecko `/global` | Risk-on/off сентимент |
| USDC Домінація | CoinGecko `/global` | Інституційні потоки |
| Загальна домінація стейблів | CoinGecko `/global` | Потік грошей в/з крипти |
| Загальна капіталізація | CoinGecko `/global` | Загальне здоров'я ринку |
| Зони ліквідацій | Розрахунок по свінг-точках | Ризик squeeze/cascade |

### ML-модель (XGBoost)
- **36 фічей** загалом (21 базових + 12 мульти-ТФ + 6 контекстних)
- **Triple-barrier labeling** — мітки на основі майбутнього руху ціни (масштабовані ATR), а не довільних порогів
- **Time-series крос-валідація** — 5 фолдів, поважає часовий порядок (без витоку даних)
- **Збалансовані ваги семплів** — коригує дисбаланс BUY/SELL/HOLD
- Навчена на ~100K семплах з 10 пар (~35 днів 5m-даних)

### LLM-аналіз (OpenAI)
- Отримує повний структурований промпт: індикатори, останні 10 свічок, 1h тренд, OI, L/S ratio, домінація стейблкоїнів, загальна капіталізація, зони ліквідацій
- Повертає JSON: напрямок, впевненість (1-10), обґрунтування, ключові рівні, оцінка ризику, режим ринку
- Обмежений за частотою на кожну пару (налаштовуваний інтервал)
- Діє як "фільтр здорового глузду" — блокує сигнали, коли макро-контекст суперечить

### Гібридна генерація сигналів
- ML-сигнал (60% ваги) + LLM-сигнал (40% ваги) — зважене голосування
- **Бонус згоди** (+20% впевненості), коли обидва погоджуються
- **Незгода = NEUTRAL** — коли ML і LLM суперечать, бот не входить
- SL/TP на основі ATR (стандартний R:R = 1:2)
- Динамічне плече залежно від впевненості та рівня ризику

### Ризик-менеджмент
- Налаштовуваний ризик на угоду (за замовчуванням 1%)
- Максимальний денний збиток (за замовчуванням 3%)
- Розмір позиції на основі відстані SL
- Плече обмежене впевненістю та оцінкою ризику

## Структура проєкту

```
aibot/
├── src/
│   ├── config.py           # Всі налаштування (API ключі, пари, таймфрейми)
│   ├── data_fetcher.py     # Завантаження даних з Binance Futures
│   ├── indicators.py       # Розрахунок технічних індикаторів (pandas_ta)
│   ├── features.py         # Фіча-інженерія, лейблінг, балансування класів
│   ├── ml_model.py         # XGBoost класифікатор (тренування, передбачення)
│   ├── llm_analyzer.py     # Інтеграція з OpenAI (промпт → JSON)
│   ├── market_context.py   # OI, L/S ratio, CoinGecko домінація, зони лікв.
│   ├── signal_generator.py # Гібридне комбінування сигналів (ML + LLM)
│   ├── risk_manager.py     # Розмір позиції, денні ліміти збитків
│   └── display.py          # Красивий вивід у консоль (Rich)
├── models/                 # Збережені ML-моделі (.json + .pkl метадані)
├── main.py                 # Точка входу сканера (цикл або --once)
├── train.py                # Пайплайн навчання ML-моделі
├── requirements.txt
├── .env.example
└── .gitignore
```

## Швидкий старт

### 1. Встановити залежності

```bash
pip install -r requirements.txt
```

### 2. Налаштувати оточення

```bash
cp .env.example .env
```

Відредагувати `.env`:
```env
BINANCE_API_KEY=ваш_ключ
BINANCE_SECRET=ваш_секрет
BINANCE_TESTNET=false
OPENAI_API_KEY=ваш_openai_ключ
OPENAI_MODEL=gpt-4o-mini
```

### 3. Навчити ML-модель

```bash
python train.py
```

Завантажує ~35 днів історичних даних по 3 таймфреймах для всіх 10 пар, обчислює фічі, створює triple-barrier мітки та навчає XGBoost з time-series крос-валідацією.

### 4. Запустити сканер

```bash
python main.py          # безперервне сканування кожні 5 хв
python main.py --once   # один скан і вихід
```

## Налаштування

Всі параметри в `src/config.py` та можуть бути перевизначені через `.env`:

| Параметр | За замовч. | Опис |
|----------|-----------|------|
| `TRADING_PAIRS` | 10 топ-пар | Список ф'ючерсних пар для сканування |
| `PRIMARY_TIMEFRAME` | `5m` | Основний таймфрейм сигналів |
| `SCAN_INTERVAL` | `300` (5 хв) | Секунди між сканами |
| `USE_LLM` | `True` | Увімкнути/вимкнути LLM-аналіз |
| `PREDICTION_THRESHOLD` | `0.6` | Мінімальна впевненість для сигналу |
| `RISK_PER_TRADE` | `0.01` (1%) | Ризик на угоду |
| `MAX_DAILY_LOSS` | `0.03` (3%) | Денний ліміт збитків |
| `DEFAULT_LEVERAGE` | `5` | Базове плече |
| `MAX_LEVERAGE` | `20` | Максимальне плече |

## Технологічний стек

- **Python 3.12+**
- **ccxt** — уніфікований API криптобірж (Binance USDM Futures)
- **pandas + pandas_ta** — обробка даних та технічні індикатори
- **XGBoost** — градієнтний бустинг для передбачення сигналів
- **scikit-learn** — time-series крос-валідація, метрики
- **OpenAI API** — GPT-4o-mini для аналізу ринку
- **CoinGecko API** — глобальні ринкові дані (безкоштовно, без авторизації)
- **Binance Futures API** — OI, L/S ratio (безкоштовно, без авторизації)
- **Rich** — красивий вивід у термінал

## Відмова від відповідальності

Це програмне забезпечення призначене **лише для навчальних та дослідницьких цілей**. Торгівля криптовалютними ф'ючерсами пов'язана зі значними ризиками. Минулі результати ML-моделі не гарантують майбутніх результатів. Завжди проводьте власне дослідження. Автори не несуть відповідальності за будь-які фінансові збитки, понесені внаслідок використання цього ПЗ.
