# AI Крипто Ф'ючерсний Інтрадей Сканер

AI-сканер для інтрадей-трейдингу криптовалютних ф'ючерсів на Binance. Поєднує навчену **ML-модель XGBoost** з **аналізом OpenAI LLM** (гібридний підхід) для генерації торгових сигналів із точками входу, стоп-лосом та тейк-профітом.

## Як це працює

```
Binance Futures API          CoinGecko API
     │                            │
     ▼                            ▼
┌─────────────┐          ┌───────────────┐
│ OHLCV дані  │          │ USDT/USDC Dom │
│ OI, L/S     │          │ Total MCap    │
│ Funding Rate│          │ Stablecoin %  │
│ Order Book  │          └───────┬───────┘
└──────┬──────┘                  │
       ▼                         ▼
┌──────────────────────────────────────┐
│       Технічні індикатори             │
│  RSI, MACD, Bollinger, EMA, ATR,     │
│  ADX, StochRSI, OBV, Volume Ratio    │
└──────────────────┬───────────────────┘
                   │
       ┌───────────┴───────────┐
       ▼                       ▼
┌─────────────┐        ┌─────────────┐
│  ML движок  │        │  LLM движок │
│  (XGBoost)  │        │  (GPT-4o)   │
│  37 фічей   │        │ Framework   │
│  Вага: 60%  │        │  Вага: 40%  │
└──────┬──────┘        └──────┬──────┘
       └──────────┬───────────┘
                  ▼
       ┌───────────────────┐
       │ Фільтри сигналів  │
       │ Volume, ADX,      │
       │ Order Book, Time  │
       └────────┬──────────┘
                ▼
       ┌───────────────────┐
       │ 1m Entry Refiner  │
       │ EMA/BB/RSI touch  │
       └────────┬──────────┘
                ▼
       ┌───────────────────┐
       │ Сигнал            │
       │ FRESH / NEW / LATE│
       │ Entry, SL, TP     │
       └───────────────────┘
```

## Можливості

### Мультипарний сканер
- Сканує **10 топових ф'ючерсних пар** одночасно
- Список пар налаштовується в `src/config.py`

### Мультитаймфреймовий аналіз
- **Основний (5m)** — 21 базова фіча
- **Підтверджуючий (15m)** — 6 фічей вищого ТФ
- **Трендовий (1h)** — 6 фічей вищого ТФ

### Ринковий контекст
| Дані | Джерело | Призначення |
|------|---------|-------------|
| Open Interest | Binance | Переконаність ринку |
| Long/Short Ratio | Binance | Позиціонування натовпу |
| Funding Rate | Binance | Вартість утримання |
| Order Book Imbalance | Binance | Bid/ask тиск, стіни |
| USDT/USDC Домінація | CoinGecko | Risk-on/off сентимент |
| Загальна капіталізація | CoinGecko | Здоров'я ринку |
| Зони ліквідацій | Розрахунок | Squeeze/cascade ризик |

### ML Ensemble (XGBoost + LightGBM + CatBoost)
- **3 моделі голосують разом** — усереднені ймовірності
- **37 фічей** (21 базових + 12 мульти-ТФ + 7 контекстних)
- **Triple-barrier labeling** — мітки на основі ATR
- **Time-series крос-валідація** — 5 фолдів на кожну модель
- **Збалансовані ваги** — коригує BUY/SELL/HOLD дисбаланс

### LLM-аналіз (OpenAI)
- **Професійний decision framework** з 6 кроками:
  1. Тренд (1H EMA)
  2. Моментум (RSI + ADX)
  3. Smart Money (L/S ratio, funding)
  4. Зони ліквідацій
  5. Order Book тиск
  6. Макро фільтр (домінація стейблів)

### Фільтри сигналів
| Фільтр | Що робить |
|--------|-----------|
| **Volume** | Блокує при низькому об'ємі |
| **ADX** | Блокує якщо немає тренду |
| **Order Book** | Блокує проти тиску стакану |
| **Time-of-day** | Блокує в мертві години |

### 1m Entry Refinement
Після 5m сигналу бот шукає кращу точку входу на 1m:
- RSI oversold/overbought → вхід на відкаті
- Дотик EMA-9 → вхід на підтримці
- Дотик Bollinger Band → вхід на екстремумі

### Трекінг сигналів
| Статус | Значення |
|--------|----------|
| **FRESH SIGNAL** | Щойно з'явився — найкращий момент |
| **NEW ~Xm** | Активний X хвилин — ще можна |
| **LATE ~Xm** | 15+ хвилин — рух частково пройшов |
| **ACTIVE HH:MM** | Відстежується, показує оригінальні рівні |

### Моніторинг угод (Trailing Stop + Health + Early Exit)
| Функція | Що робить |
|---------|-----------|
| **Trailing Stop** | Рухає SL за ціною після 1.5x ATR профіту |
| **Протилежний сигнал** | Закриває якщо ML розвернувся |
| **Health Check** | Перевіряє RSI, ADX, volume: HEALTHY → WEAKENING → CLOSE_EARLY |
| **Auto-Track** | Live сканер автоматично трекає коли з'являється FRESH > 55% |

### Бектестинг
- **Out-of-sample**: навчання 70% / тест 30%
- **Реалістичне виконання**: вхід по наступній свічці, комісії, проскальзування
- **Trailing stop + early exit** активні в бектесті
- **Фільтри включені** в бектест
- **Результат**: +97-167% net PnL за ~10 днів

### Авто-переобучення
- Порівнює accuracy з поточною моделлю
- Замінює тільки якщо нова краща
- Крон: кожні 2 дні автоматично

## Структура проєкту

```
aibot/
├── src/
│   ├── config.py           # Налаштування
│   ├── data_fetcher.py     # Завантаження даних Binance
│   ├── indicators.py       # Технічні індикатори
│   ├── features.py         # Фіча-інженерія, лейблінг
│   ├── ml_model.py         # XGBoost класифікатор
│   ├── llm_analyzer.py     # OpenAI з decision framework
│   ├── market_context.py   # OI, L/S, домінація, стакан, ліквідації
│   ├── signal_generator.py # Гібрид ML+LLM + фільтри
│   ├── entry_refiner.py    # 1m entry refinement
│   ├── trade_monitor.py    # Trailing stop, health, early exit
│   ├── risk_manager.py     # Розмір позиції
│   └── display.py          # Консольний вивід + моніторинг угод
├── main.py                 # Live сканер
├── train.py                # Навчання ML
├── backtest.py             # Out-of-sample бектест
├── backtest_llm.py         # LLM бектест
├── auto_retrain.py         # Авто-переобучення
├── deploy.sh               # Деплой на сервер
├── requirements.txt
└── .env.example
```

## Швидкий старт

```bash
pip install -r requirements.txt
cp .env.example .env        # вставити ключі
python train.py             # навчити модель
python main.py              # запустити сканер
python backtest.py           # бектест
```

## Деплой на сервер

```bash
git clone https://github.com/tolyanoo95/aibot2.git /root/aibot
cd /root/aibot
bash deploy.sh
nano .env
systemctl start aibot
```

## Відмова від відповідальності

Це ПЗ призначене **лише для навчальних та дослідницьких цілей**. Торгівля криптовалютними ф'ючерсами пов'язана зі значними ризиками. Автори не несуть відповідальності за фінансові збитки.
